#Copies clinical CDI sample sequence data files from miseq_runs folder in schloss-lab turbo storage to my CDI_clinical_samples project directory. This script is a record of bash commands used, since it is just moving/renaming files there is no need to submit as a job. For each library, the water & mock fastqs will be renamed to match the CDI plate number they were in. After sequences from all libraries have been transferred to the project's raw data directory, we will remove the dashes, M#, and PBS parts of the sample names so that just the KR##### is left to make downstream analysis easier. All of the information about aliquots used and whether PBS was added to the samples is kept track in the metadata.
#Note: We start off at plate 5, because 376 samples had already been sequenced by Micah and the microbiome core. Separate aliquots of each of those 376 samples were sequenced by the Schloss lab so that all 3943 samples are represented below.)

#After logging onto Great lakes go to labs turbo storage:
cd /nfs/turbo/schloss-lab

#Library for plates 5-8
#Copy raw data files into CDI_clinical_samples directory for data analysis
cp miseq_runs/2019_runs/SarahCDIp5-p8_Aug2019/Data/Intensities/BaseCalls/*.fastq.gz tomkoset/CDI_clinical_samples/data/raw/
#Change into raw data directory
cd tomkoset/CDI_clinical_samples/data/raw/
# Rename #Mock & water controls to match the plate number they were in
rename 'mock1' mock5 *.gz
rename 'Mock2' mock6 *.gz
rename 'mock3' mock7 *.gz
rename 'Mock-w-KR00350-M2-contamination' mock8contamKR00350 *.gz
rename 'water1' water5 *.gz
rename 'water2' water6 *.gz
rename 'water3' water7 *.gz
rename 'water4' water8 *.gz
#Remove Undetermined fastq.gz filenames
rm Undetermined*.fastq.gz
#Remove contaminated mock sample since we can't use it since its a mix of mock and another sample
rm mock8contamKR00350*.fastq.gz
go to labs turbo storage:
cd /nfs/turbo/schloss-lab

#Library for plates 9-12 (see plates 5-8 above for commented explaination of each step)
cp miseq_runs/2019_runs/SarahCDI_p9-p12_Aug2019/Data/Intensities/BaseCalls/*.fastq.gz tomkoset/CDI_clinical_samples/data/raw/
cd tomkoset/CDI_clinical_samples/data/raw/
rename 'mock1' mock9 *.gz
rename 'mock2' mock10 *.gz
rename 'mock3' mock11 *.gz
rename 'mock4' mock12 *.gz
rename 'water1' water9 *.gz
rename 'water2' water10 *.gz
rename 'water3' water11 *.gz
rename 'water4' water12 *.gz
rm Undetermined*.fastq.gz
cd /nfs/turbo/schloss-lab

#Library for plates 13-16 (see plates 5-8 above for commented explaination of each step)
cp miseq_runs/2019_runs/Sarah_CDIp13-16_Sep2019/Data/Intensities/BaseCalls/*.fastq.gz tomkoset/CDI_clinical_samples/data/raw/
cd tomkoset/CDI_clinical_samples/data/raw/
rename 'mock1' mock13 *.gz
rename 'mock2' mock14 *.gz
rename 'mock3' mock15 *.gz
rename 'mock4' mock16 *.gz
rename 'water1' water13 *.gz
rename 'water2' water14 *.gz
rename 'water3' water15 *.gz
rename 'water4' water16 *.gz
rm Undetermined*.fastq.gz
cd /nfs/turbo/schloss-lab

#Library for plates 17-20 (see plates 5-8 above for commented explaination of each step)
cp miseq_runs/2019_runs/SarahCDI_p17-p20/Data/Intensities/BaseCalls/*.fastq.gz tomkoset/CDI_clinical_samples/data/raw/
cd tomkoset/CDI_clinical_samples/data/raw/
rename 'mock1' mock17 *.gz
rename 'mock2' mock18 *.gz
rename 'mock3' mock19 *.gz
rename 'mock4' mock20 *.gz
rename 'water1' water17 *.gz
rename 'water2' water18 *.gz
rename 'water3' water19 *.gz
#No water4 sequences in this library for some reason
rm Undetermined*.fastq.gz
cd /nfs/turbo/schloss-lab

#Library for plates 21-24 (see plates 5-8 above for commented explaination of each step)
cp miseq_runs/2019_runs/SarahCDI_p21-p24/Data/Intensities/BaseCalls/*.fastq.gz tomkoset/CDI_clinical_samples/data/raw/
cd tomkoset/CDI_clinical_samples/data/raw/
rename 'mock1' mock21 *.gz
rename 'mock2' mock22 *.gz
rename 'mock3' mock23 *.gz
rename 'mock4' mock24 *.gz
rename 'pcr-water1' water21 *.gz
rename 'pcr-water2' water22 *.gz
rename 'pcr-water3' water23 *.gz
rename 'pcr-water4' water24 *.gz
rm Undetermined*.fastq.gz
cd /nfs/turbo/schloss-lab

#Library for plates 25-28 (see plates 5-8 above for commented explaination of each step)
cp miseq_runs/2019_runs/SarahCDI_p25-28/Data/Intensities/BaseCalls/*.fastq.gz tomkoset/CDI_clinical_samples/data/raw/
cd tomkoset/CDI_clinical_samples/data/raw/
rename 'mock' mock25 *.gz
rename 'mock2' mock26 *.gz
rename 'mock3' mock28 *.gz
#No mock4, mock not included on p27 according to the plate layout
rename 'water' water25 *.gz
rename 'water2' water26 *.gz
rename 'water3' water27 *.gz
rename 'water4' water28 *.gz
rm Undetermined*.fastq.gz
cd /nfs/turbo/schloss-lab

#Library for plates 29-32 (see plates 5-8 above for commented explaination of each step)
cp miseq_runs/2019_runs/SarahCDI_p29-32/Data/Intensities/BaseCalls/*.fastq.gz tomkoset/CDI_clinical_samples/data/raw/
cd tomkoset/CDI_clinical_samples/data/raw/
rename 'mock1' mock30 *.gz
rename 'mock2' mock32 *.gz
# Mock not included on p29 and p31 according to the plate layout
rename 'water1' water30 *.gz
rename 'water2' water32 *.gz
# Water not included on p29 and p31 according to the plate layout
rm Undetermined*.fastq.gz
cd /nfs/turbo/schloss-lab

#Library for plates 33-36 (see plates 5-8 above for commented explaination of each step)
cp miseq_runs/2020_runs/SarahCDI_p33-p36_jan2020/Intensities/BaseCalls/*.fastq.gz tomkoset/CDI_clinical_samples/data/raw/
cd tomkoset/CDI_clinical_samples/data/raw/
rename 'mock' mock33 *.gz
rename 'mock2' mock34 *.gz
rename 'mock3' mock35 *.gz
rename 'mock4' mock36 *.gz
rename 'water' water33 *.gz
rename 'water2' water34 *.gz
rename 'water3' water35 *.gz
rename 'water4' water36 *.gz
rm Undetermined*.fastq.gz
cd /nfs/turbo/schloss-lab

#Library for plates 37-40 (see plates 5-8 above for commented explaination of each step)
cp miseq_runs/2020_runs/SarahCDI_p37-p40/Intensities/BaseCalls/*.fastq.gz tomkoset/CDI_clinical_samples/data/raw/
cd tomkoset/CDI_clinical_samples/data/raw/
rename 'mock1' mock37 *.gz
rename 'mock2' mock38 *.gz
rename 'mock3' mock39 *.gz
rename 'mock4' mock40 *.gz
rename 'water1' water37 *.gz
rename 'water2' water38 *.gz
rename 'water3' water39 *.gz
rename 'water4' water40 *.gz
rm Undetermined*.fastq.gz
#Plate_37, first 7 rows of samples failed due to epMotion error during DNA extractions and are highlighted in orange on sample sheet. These samples are not in the BaseCalls/ folder so need to worry about removing the corresponding fastq.gz files. The replacement sequences for these first 7 rows are included on Plate_47
cd /nfs/turbo/schloss-lab

#Library for plates 41-44 (see plates 5-8 above for commented explaination of each step)
cp miseq_runs/2020_runs/SarahCDI_p41-p44_Jan2020/Intensities/BaseCalls/*.fastq.gz tomkoset/CDI_clinical_samples/data/raw/
cd tomkoset/CDI_clinical_samples/data/raw/
rename 'mock1' mock41 *.gz
rename 'mock2' mock42 *.gz
rename 'mock3' mock43 *.gz
rename 'mock4' mock44 *.gz
rename 'water1' water41 *.gz
rename 'water2' water42 *.gz
rename 'water3' water43 *.gz
rename 'water4' water44 *.gz
rm Undetermined*.fastq.gz
cd /nfs/turbo/schloss-lab

#Library for plates 45-47 (see plates 5-8 above for commented explaination of each step). This time need to be more specific about the files we copy over (Only want samples that start with KR*, mock* or water*) since this library also included samples for a separate project (the motility project). This library also includes 3 different PBS aliquots which were added to some of the samples as noted in the corresponding metadata file
cp miseq_runs/2020_runs/SarahCDI_p45p46_motility/Intensities/BaseCalls/KR*.fastq.gz tomkoset/CDI_clinical_samples/data/raw/
cp miseq_runs/2020_runs/SarahCDI_p45p46_motility/Intensities/BaseCalls/mock*.fastq.gz tomkoset/CDI_clinical_samples/data/raw/
cp miseq_runs/2020_runs/SarahCDI_p45p46_motility/Intensities/BaseCalls/water*.fastq.gz tomkoset/CDI_clinical_samples/data/raw/
cp miseq_runs/2020_runs/SarahCDI_p45p46_motility/Intensities/BaseCalls/PBS*.fastq.gz tomkoset/CDI_clinical_samples/data/raw/
cd tomkoset/CDI_clinical_samples/data/raw/
rename 'mock1' mock45 *.gz
rename 'mock2' mock46 *.gz
rename 'mock3' mock47 *.gz
rm mock4*.gz
rename 'water1' water45 *.gz
rename 'water2' water46 *.gz
rename 'water3' water47 *.gz
rm water4*.gz
#Remove the mock and waters for the last plate of this library, as all of those sequences were part of a different project.
rename 'PBS-aliquot-1' PBS1 *.gz
rename 'PBS-aliquot-2' PBS2 *.gz
rename 'PBS-aliquot-3' PBS3 *.gz

#Remove -PBS and -M# from .gz filenames for all samples (do these steps once sequences from all libraries have been transferred to raw data folder). This information is already recorded in the corresponding metadata file.
#First remove dashes before removing each remaining combination. Removes the dashes before M# and PBS.
#Change into raw data directory
cd tomkoset/CDI_clinical_samples/data/raw/
for file in *.gz; do mv "$file" "$(echo "$file" | sed 's/-/'""'/g')"; done
# Remove PBS from sample id
rename 'PBS_' _ *.gz
# Now remove M1, M2, and M3 (denotes the 3 different microbiome aliquots that were stored per sample) from sample id
rename 'M1_' _ *.gz
rename 'M2_' _ *.gz
rename 'M3_' _ *.gz
