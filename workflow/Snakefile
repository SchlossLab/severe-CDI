configfile: 'config/default.yml'

MEM_PER_GB=1024
ncores = config['ncores']
ml_methods = config['ml_methods']
kfold = config['kfold']

nseeds = config['nseeds']
start_seed = 100
seeds = range(start_seed, start_seed + nseeds)

include: 'rules/mothur.smk'
include: 'rules/machine-learning.smk'

rule targets:
    input:
        'workflow/report/report.md'

rule classify_idsa_severity:
    input:
        'code/severity_analysis.R',
        "code/utilities.R",
        "data/process/final_CDI_16S_metadata.tsv",
        "data/raw/max_creat.csv", # TODO: email SET to get these files
        "data/raw/max_wbc.csv",
        "data/raw/r21_fullcohort_edited_deidentified.csv",
        "data/raw/HPI-1878 Lab.csv"
    output:
        csv="data/process/case_idsa_severity.csv",
        png="results/figures/idsa_severe_n.png"
    script:
        'code/severity_analysis.R'

rule prep_data_for_ml:
    input:
        'scripts/prep_data_for_ml.R'
    output:
        'data/process/cases_severity_OTUs.csv'
    script:
        'scripts/prep_data_for_ml.R'